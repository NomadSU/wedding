server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # API (FastAPI)
  location /api/ {
    # В Dockhost часто запускается только один контейнер из Dockerfile.
    # Поэтому FastAPI мы поднимаем ВНУТРИ этого же контейнера на 127.0.0.1:8000.
    proxy_pass http://127.0.0.1:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # Админка
  location /admin {
    proxy_pass http://127.0.0.1:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # Главная страница живёт в корне домена, но физически лежит в /vladimirliliya
  # ВАЖНО: без редиректов — просто отдаём файл.
  location = / {
    try_files /vladimirliliya/index.html =404;
  }

  # На случай прямого захода на /index.html
  location = /index.html {
    try_files /vladimirliliya/index.html =404;
  }

  # Поддержка URL без расширения .html + прозрачный доступ к файлам из /vladimirliliya
  # (например, /content.json, /survey.js, /img/boys.png и т.д.)
  location / {
    try_files
      $uri $uri/ $uri.html
      /vladimirliliya$uri /vladimirliliya$uri/ /vladimirliliya$uri.html
      /vladimirliliya/index.html;
  }
}
